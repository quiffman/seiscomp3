SET(ISI_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../ISI_Toolkit_1_3_0)
SET(ISI_LIB ${ISI_DIR}/lib/libisi.a)

SET(NRTSPLUGIN_SOURCES
	nrts_plugin.c
	../plugin.c
)

INCLUDE_DIRECTORIES(.)
INCLUDE_DIRECTORIES(..)
INCLUDE_DIRECTORIES(${ISI_DIR}/include)

SET(OSNAME LINUX)
SET(OPTIONS -DSYSLOG_FACILITY=LOG_LOCAL0)
SET(PLATFORM -D${OSNAME})

ADD_DEFINITIONS(${OPTIONS} ${PLATFORM})

ADD_EXECUTABLE(nrts_plugin ${NRTSPLUGIN_SOURCES})

ADD_CUSTOM_COMMAND(
	OUTPUT ${ISI_LIB}
	COMMAND ${CMAKE_MAKE_PROGRAM} ARGS -C ${ISI_DIR}/lib OSNAME=${OSNAME}
)

SET_SOURCE_FILES_PROPERTIES(
	nrts_plugin.c
	PROPERTIES OBJECT_DEPENDS ${ISI_LIB}
)

TARGET_LINK_LIBRARIES(nrts_plugin ${ISI_LIB} pthread rt m)

INSTALL(TARGETS nrts_plugin RUNTIME DESTINATION ${SEEDLINK_PLUGIN_OUTPUT_DIR})

FILE(GLOB descs "${CMAKE_CURRENT_SOURCE_DIR}/descriptions/*.xml")
INSTALL(FILES ${descs} DESTINATION ${SC3_PACKAGE_APP_DESC_DIR})
